<!-- Tabla de evoluciones -->
<div ng-controller="internacion/iEvolucionar">

    <div class="card card-block"  ng-show="show_toolbar">
        <div class="row">
            <div class="col-xs-4">
                <h2 class="md-headline">Evoluciones del paciente</h2>
            </div>
            <div class="col-xs-4">
                <div class="form-group"></div>
            </div>
            <div class="col-xs-6 text-right">
                <div class="form-group">
                    <select class="form-control" label="Servicio" ng-model="filtros.servicio" ng-click="filtros.filtrar()" plex="(servicio.nombreCorto) for servicio in servicios"></select>
                </div>
            </div>

            <div class="col-xs-2 text-right" ng-if="internacion.estado != 'egresado'" ng-show="show_toolbar">
                <br/>
                <button class="btn btn-primary form-control" ng-click="editarEvolucion();">
                    Nueva evolución
                </button>
            </div>
        </div>

        <table class="table table-hover table-striped" ng-if="internacion.evoluciones && internacion.evoluciones.length > 0" ng-if="!evolucionesEdit">
            <thead >
                <tr>
                    <th >
                        Fecha
                    </th>
                    <th style="width: 40%;">
                        Detalle
                    </th>
                    <th >
                        FC
                    </th>
                    <th >
                        Tensión
                    </th>
                    <th >
                        Temperatura
                    </th>
                    <th >
                        FR
                    </th>
                    <th >
                        Saturación
                    </th>
                    <th >
                        Peso
                    </th>
                    <th >
                        Balance líquidos
                    </th>
                    <th >
                        Usuario / Servicio
                    </th>
                    <th></th>
                </tr>
            </thead>
            <tbody>
                <tr data-ng-repeat="item in filtros.evoluciones | orderBy: '-fechaHora'">
                    <td >
                        {{item.fechaHora | fromNow }}<br/>
                        <div class="text-muted small">
                            {{item.fechaHora | date: "dd/MM/yyyy HH:mm"}}
                        </div>
                    </td>
                    <td >
                        {{item.texto}}
                    </td>
                    <td >
                        <span ng-if="item.pulso">{{item.pulso}}
                            PPM</span>
                    </td>
                    <td >
                        <span ng-if="item.tensionDiastolica && item.tensionSistolica">{{item.tensionDiastolica + "/" + item.tensionSistolica}}</span>
                    </td>
                    <td >
                        <span ng-if="item.temperatura">{{item.temperatura}}º</span>
                    </td>
                    <td >
                        <span ng-if="item.respiracion">{{item.respiracion}}
                            RPM</span>
                    </td>
                    <td >
                        <span ng-if="item.spo2">{{item.spo2}}%</span>
                    </td>
                    <td >
                        <span ng-if="item.peso">{{item.peso}}
                            Kg</span>
                    </td>
                    <td >

                        <table ng-if="item.$total_ingresos || item.$total_ingresos > 0">
                            <tr>
                                <td>
                                    I =
                                    {{item.$total_ingresos}}
                                    <br/>
                                    E =
                                    {{item.$total_egresos}}
                                </td>
                                <td style="text-align: center; vertical-align: middle;">
                                    <i class="verde mdi mdi-trending-up" ng-if="item.$balance < 0"></i>
                                    <i class="celeste mdi mdi-trending-flat" ng-if="item.$balance == 0"></i>
                                    <i class="rojo mdi mdi-trending-down" ng-if="item.$balance > 0"></i>
                                </td>
                            </tr>
                        </table>

                    </td>
                    <td >
                        {{item.createdBy.name}}
                        <br/>
                        {{item.servicio.nombreCorto}}
                    </td>
                    <td >
                        <button ng-if='item.tipo == Session.variables.prestaciones_workflow' class="btn btn-default btn-flat tips" title="Editar evolución" ng-click="editarEvolucion(item);">
                            <i class="mdi mdi-pencil"></i>
                        </button>
                    </td>
                </tr>
            </tbody>
        </table>

    </div>

    <div ng-if="evolucionesEdit">
        <ng-form name="formEditarEvolucion" ng-show="!loading">
            <fieldset>
                <!-- <legend>{{tituloFormulario}}</legend> -->


                <div class="row">
                    <div class="col-lg-12" plex-tabs ng-model="tab">
                        <ul class="nav nav-tabs">
                            <li>
                                <a>
                                    Fecha y hora
                                </a>
                            </li>
                            <li>
                            <!-- <li ng-if='Session.variables.prestaciones_workflow == "enfermero"'> -->
                                <a>
                                    Signos vitales
                                </a>
                            </li>
                            <li>
                            <!-- <li ng-if='Session.variables.prestaciones_workflow == "enfermero"'> -->
                                <a>
                                    Ingresos líquidos
                                </a>
                            </li>
                            <li>
                            <!-- <li ng-if='Session.variables.prestaciones_workflow == "enfermero"'> -->
                                <a>
                                    Egresos líquidos
                                </a>
                            </li>
                            <li>
                                <a>
                                    Texto evolución
                                </a>
                            </li>
                        </ul>

                        <div class="card card-block">
                            <div class="row">
                                <div class="col-xs-3">
                                    <div class="form-group">
                                        <input type="text" label="Fecha evolución" ng-model="evolucionesEdit.fechaHora" plex="date">
                                    </div>
                                </div>

                                <div class="col-xs-3">
                                    <div class="form-group">
                                        <input type="text" label="Hora evolución" ng-model="evolucionesEdit.fechaHora" plex="time">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- <div ng-if='Session.variables.prestaciones_workflow == "enfermero"'> -->
                        <div class="card card-block">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <input type="text" ng-model="evolucionesEdit.pulso" label="Frecuencia cardíaca" suffix="PPM" plex="int" plex/>
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <div class="form-group">
                                        <input type="text" ng-model="evolucionesEdit.respiracion" label="Frecuencia respiratoria" suffix="RPM" plex="int" plex/>
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <div class="form-group">
                                        <input type="text" ng-model="evolucionesEdit.tensionDiastolica" label="Tensión diastólica" suffix="mmHG" plex="int" plex/>
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <div class="form-group">
                                        <input type="text" ng-model="evolucionesEdit.tensionSistolica" label="Tensión sistólica" suffix="mmHG" plex="int" plex/>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <input type="text" ng-model="evolucionesEdit.temperatura" label="Temperatura" suffix="º C" plex="float" plex/>
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <div class="form-group">
                                        <input type="text" ng-model="evolucionesEdit.spo2" label="Saturación O&#178;" suffix="%" plex="int" plex-min="0" plex-max="100" plex/>
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <div class="form-group">
                                        <input type="text" ng-model="evolucionesEdit.peso" label="Peso" suffix="Kgs" plex="float" plex/>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- <div ng-if='Session.variables.prestaciones_workflow == "enfermero"'> -->
                        <div class="card card-block">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <input type="text" ng-model="evolucionesEdit.ingresos.ph" label="P.H I" plex/>
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <div class="form-group">
                                        <input type="text" ng-model="evolucionesEdit.ingresos.ph2" label="P.H II" plex/>
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <div class="form-group">
                                        <input type="text" ng-model="evolucionesEdit.ingresos.atb" label="ATB" plex/>
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <div class="form-group">
                                        <input type="text" ng-model="evolucionesEdit.ingresos.hemo" label="HEMO." plex/>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <input label="NP" type="text" ng-model="evolucionesEdit.ingresos.np" plex/>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <input label="Prep." type="text" ng-model="evolucionesEdit.ingresos.prep" plex/>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <input label="H20" type="text" ng-model="evolucionesEdit.ingresos.h2o" plex/>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- <div ng-if='Session.variables.prestaciones_workflow == "enfermero"'> -->
                        <div class="card card-block">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <input type="text" ng-model="evolucionesEdit.egresos.lavadoVesicalI" label="Lavado vesical I" plex/>
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <div class="form-group">
                                        <input type="text" ng-model="evolucionesEdit.egresos.diuresis" label="Diuresis" plex/>
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <div class="form-group">
                                        <input type="text" ng-model="evolucionesEdit.egresos.catarsis" label="Catarsis" plex/>
                                    </div>
                                </div>

                                <div class="col-md-3">
                                    <div class="form-group">
                                        <input type="text" ng-model="evolucionesEdit.egresos.sng" label="S.N.G" plex/>
                                    </div>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <input  label="Drenajes"  type="text" ng-model="evolucionesEdit.egresos.drenajes" plex/>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <input  label="Drenajes II" type="text" ng-model="evolucionesEdit.egresos.drenajes2" plex/>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <input type="text" ng-model="evolucionesEdit.egresos.ostomias" label="Ostomias I" plex/>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <input type="text" ng-model="evolucionesEdit.egresos.ostomias2" label="Ostomias II" plex/>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="card card-block">
                            <div class="row" ng-if="internaciones.evoluciones.length > 0">
                                <div class="col-lg-12">
                                    Hola
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-12">
                                    <div class="form-group">
                                        <textarea label="Descripción" placeholder="Consignar los tratamientos y cuidados efectuados y los síntomas observados" plex-focus="true" ng-model="evolucionesEdit.texto" plex ng-required="true" rows="5" class="form-control"></textarea>
                                    </div>
                                </div>
                            </div>

                        </div>

                    </div>

                </div>
                <div class="row">
                    <div class="col-lg-12">
                        <div class="card card-block margin-top text-right">
                            <button type="button" class="btn btn-default btn-flat" ng-click="cancelarEdicion();">Cancelar</button>
                            <button class="btn btn-primary" plex-submit="guardarEvolucion(evolucionesEdit)" ng-disabled="formEditarEvolucion.$invalid">Guardar</button>
                        </div>
                    </div>
                </div>
            </fieldset>
        </ng-form>

    </div>

</div>
<!-- TODO ocultar tab ingresos liquidos si es medico
ng-if='Session.variables.prestaciones_workflow == "enfermero"'
-->
<!-- TODO ocultar tab egresos liquidos si es medico
ng-if='Session.variables.prestaciones_workflow == "enfermero"'
-->
