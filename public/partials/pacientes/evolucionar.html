<div class="row">
    <div class="col-sm-12">
        <div plex-include="'partials/Pacientes/iHeader.html'" plex-include-internacion="internacion"></div>
    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <form name="formEvolucion">

            <div class="box">
                <div class="box-header">
                    <h3 class="box-title">
                        Hoja de control de signos vitales y balance hidroelectrolítico
                    </h3>
                </div>

                <div class="box-body">

                    <div class="row">

                        <div class="col-md-4">
                            <input type="text" plex="date" ng-required="true" ng-model="evoluciones.fechaHora" label="Fecha"/>
                        </div>
                        <div class="col-md-4">
                            <input type="text" plex="time" ng-required="true" ng-model="evoluciones.fechaHora" label="Hora"/>
                        </div>
                        <div class="col-md-2">
                            <input type="text" ng-required="true" ng-model="evoluciones.pulso" label="Pulso" placeholder="F.C" plex="int"/>
                        </div>
                    </div>
                    <div class="row">

                        <div class="col-md-2">
                            <input type="text" ng-required="true" ng-model="evoluciones.tensionDiastolica" label="Tensión diastólica" placeholder="mmHG" plex="int"/>
                        </div>
                        <div class="col-md-2">
                            <input type="text" ng-required="true" ng-model="evoluciones.tensionSistolica" label="Tensión sistólica" placeholder="mmHG" plex="int"/>
                        </div>
                        <div class="col-md-2">
                            <input type="text" ng-required="true" ng-model="evoluciones.temperatura" label="Tº" placeholder="ºC" plex="float"/>
                        </div>
                        <div class="col-md-2">
                            <input type="text" ng-required="true" ng-model="evoluciones.respiracion" label="Resp." placeholder="F.R" plex="int"/>
                        </div>
                        <div class="col-md-2">
                            <input type="text" ng-required="true" ng-model="evoluciones.spo2" label="%Sp02" placeholder="%" plex="int" plex-min="0" plex-max="100"/>
                        </div>

                        <div class="col-md-2">
                            <input type="text" ng-required="true" ng-model="evoluciones.peso" label="Peso" placeholder="Kgs" plex="float"/>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-12">
                            <textarea class="" label="Descripción" placeholder="Consignar los tratamientos y cuidados efectuados y los síntomas observados" ng-model="evoluciones.texto" plex ng-required="true" rows="5"></textarea>
                        </div>
                    </div>
                </div>

                <div class="box-footer">
                    <div class="col-md-6">
                        <div class="form-group">
                            <input type="checkbox" ng-model="volverAlMapa" id="volverAlMapa" name="volverAlMapa"/>
                            <label for="volverAlMapa">Regresar al mapa de camas luego de guardar</label>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-success pull-right" plex-submit="crearEvolucion()" ng-disabled="formEvolucion.$invalid">
                        Crear evolución
                    </button>
                </div>

            </div>

        </form>
    </div>
</div>

<div ng-if="internacion.evoluciones && internacion.evoluciones.length > 0">
    <div class="row">
        <div class="col-lg-12">
            <div class="box box-primary">
                <div class="box-header">
                    <h3 class="box-title">Evoluciones del paciente</h3>
                    <div class="box-tools pull-right">

                        <!-- <ul class="" style="list-style: none;">
                            <li ng-if="servicios.length > 1" class="dropdown">
                                <a bs-dropdown="servicios" class="btn btn-default" >
                                    {{servicios[0].nombreCorto}}
                                    <span class="caret"></span>
                                </a>
                            </li>
                        </ul> -->

                        <select name="servicios"  ng-click="filtros.filtrar()" ng-model="filtros.servicio">
                            <option ng-repeat="servicio in servicios" value="{{servicio.id}}" >{{servicio.nombreCorto}}</option>
                        </select>

                    </div>
                </div>
                <div class="box-body ">
                    <div class="text-center" ng-show="loading">
                        <i class="fa fa-spinner fa-spin"></i>
                    </div>

                    <ng-form name="formEditarEvolucion" ng-show="!loading">
                        <table class="table table-bordered table-hover ">
                            <thead>
                                <tr>
                                    <th>
                                        Fecha
                                    </th>
                                    <th>
                                        Hora
                                    </th>
                                    <th>
                                        Pulso
                                    </th>
                                    <th>
                                        TD
                                    </th>
                                    <th>
                                        TA
                                    </th>
                                    <th>
                                        Tª
                                    </th>
                                    <th>
                                        Resp.
                                    </th>
                                    <th>
                                        %SpO2
                                    </th>
                                    <th>
                                        Peso
                                    </th>
                                    <th>
                                        Usuario
                                    </th>
                                    <th>
                                        Acciones
                                    </th>
                                </tr>
                            </thead>
                            <tbody>

                                <tr ng-repeat="item in filtros.evoluciones | orderBy: '-fechaHora'">
                                    <td ng-if="item.$editing" colspan="10">
                                        <div class="row">

                                            <div class="col-md-4">
                                                <input type="text" plex="date" ng-required="true" ng-model="evolucionesEdit.fechaHora" label="Fecha"/>
                                            </div>
                                            <div class="col-md-4">
                                                <input type="text" plex="time" ng-required="true" ng-model="evolucionesEdit.fechaHora" label="Hora"/>
                                            </div>
                                            <div class="col-md-2">
                                                <input type="text" ng-required="true" ng-model="evolucionesEdit.pulso" label="Pulso" placeholder="F.C" plex="int"/>
                                            </div>
                                        </div>
                                        <div class="row">

                                            <div class="col-md-2">
                                                <input type="text" ng-required="true" ng-model="evolucionesEdit.tensionDiastolica" label="Tensión diastólica" placeholder="mmHG" plex="int"/>
                                            </div>
                                            <div class="col-md-2">
                                                <input type="text" ng-required="true" ng-model="evolucionesEdit.tensionSistolica" label="Tensión sistólica" placeholder="mmHG" plex="int"/>
                                            </div>
                                            <div class="col-md-2">
                                                <input type="text" ng-required="true" ng-model="evolucionesEdit.temperatura" label="Tº" placeholder="ºC" plex="float"/>
                                            </div>
                                            <div class="col-md-2">
                                                <input type="text" ng-required="true" ng-model="evolucionesEdit.respiracion" label="Resp." placeholder="F.R" plex="int"/>
                                            </div>
                                            <div class="col-md-2">
                                                <input type="text" ng-required="true" ng-model="evolucionesEdit.spo2" label="%Sp02" placeholder="%" plex="int" plex-min="0" plex-max="100"/>
                                            </div>

                                            <div class="col-md-2">
                                                <input type="text" ng-required="true" ng-model="evolucionesEdit.peso" label="Peso" placeholder="Kgs" plex="float"/>
                                            </div>

                                            <input type="hidden" ng-model="evolucionesEdit.id"/>
                                            <input type="hidden" ng-model="evolucionesEdit.servicio._id"/>
                                        </div>

                                        <div class="row">
                                            <div class="col-md-12">
                                                <textarea class="" label="Descripción" placeholder="Consignar los tratamientos y cuidados efectuados y los síntomas observados" ng-model="evolucionesEdit.texto" plex ng-required="true" rows="5"></textarea>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-12">
                                                <button type="button" class="btn btn-warning " ng-click="item.$editing = false">
                                                    Cancelar
                                                </button>

                                                <button type="submit" class="btn btn-success pull-right" plex-submit="guardarEvolucion(evolucionesEdit)" ng-disabled="formEditarEvolucion.$invalid">
                                                    Guardar evolución
                                                </button>

                                            </div>
                                        </div>
                                    </td>

                                    <td ng-if="!item.$editing">
                                        {{item.fechaHora | date: "dd/MM/yyyy"}}
                                    </td>
                                    <td ng-if="!item.$editing">
                                        {{item.fechaHora | date: "HH:mm"}}

                                    </td>
                                    <td ng-if="!item.$editing">
                                        {{item.pulso}}
                                    </td>
                                    <td ng-if="!item.$editing">
                                        {{item.tensionDiastolica}}
                                    </td>
                                    <td ng-if="!item.$editing">
                                        {{item.tensionSistolica}}
                                    </td>
                                    <td ng-if="!item.$editing">
                                        {{item.temperatura}}
                                    </td>
                                    <td ng-if="!item.$editing">
                                        {{item.respiracion}}
                                    </td>
                                    <td ng-if="!item.$editing">
                                        {{item.spo2}}
                                    </td>
                                    <td ng-if="!item.$editing">
                                        {{item.peso}}
                                    </td>
                                    <td ng-if="!item.$editing">

                                    </td>
                                    <td class="text-center" ng-if="!item.$editing">
                                        <button type="button" class="btn btn-sm btn-primary tips" ng-click="editarEvolucion(item); item.$editing = true;" title="Editar evolucion">
                                            <i class="fa fa-pencil"></i>
                                        </button>
                                    </td>

                                </tr>

                            </tbody>
                        </table>
                    </ng-form>
                </div>
            </div>
        </div>
    </div>
</div>
