<div plex-include="'partials/Pacientes/iHeader.html'" plex-include-internacion="internacion"></div>

<div class="row">
    <div class="col-lg-12" plex-tabs ng-model="tab">
        <ul class="nav nav-tabs">
            <li>
                <a>
                    Resúmen internación
                </a>
            </li>
            <li>
                <a>
                    Gráficos
                </a>
            </li>
            <li>
                <a>
                    Ingreso de internación
                </a>
            </li>
            <li>
                <a>
                    Evoluciones
                </a>
            </li>
            <li>
                <!-- <li ng-if='Session.variables.prestaciones_workflow == "enfermero"'> -->
                <a>
                    Drenajes
                </a>
            </li>
            <li>
                <a>
                    Antecedentes
                </a>
            </li>

            <li>
                <a>
                    Pases
                </a>
            </li>
            <li>
                <a>
                    Pedidos de prestaciones
                </a>
            </li>
            <li ng-class="{'disabled': !internacion.egreso}">
                <a>
                    Egreso
                </a>
            </li>
            <li>
                <a>
                    Historial
                </a>
            </li>
        </ul>

        <div class="card card-block">

            <div class="card-deck-wrapper">
                <div class="card-deck">
                    <div class="card dashboard-card">
                        <div class="card-header card-blue">
                            <div class="card-header-icon">
                                <i class="mdi mdi-chart-bar"></i>
                            </div>
                            <div class="card-header-title">

                                <div class="title">Gráficos</div>
                                <div class="subtitle">Gráficas de internacion de un pacientes.</div>
                            </div>
                        </div>
                        <div class="card-block">
                            <p class="card-text">
                                Puede ver gráficas de
                                <ul>
                                    <li>
                                        Balance de líquidos
                                    </li>
                                    <li>
                                        Temperatura
                                    </li>
                                </ul>
                            </p>

                            <button type="button" class="btn btn-default col-lg-12" ng-click="tab = 1">
                                Ir a los gráficos
                            </button>
                        </div>
                    </div>

                    <div class="card dashboard-card">
                        <div class="card-header card-green">
                            <div class="card-header-icon">
                                <i class="mdi mdi-clipboard-outline"></i>
                            </div>
                            <div class="card-header-title">

                                <div class="title">Ultima evolución</div>
                                <div class="subtitle"></div>
                            </div>
                        </div>
                        <div class="card-block">
                            <p class="card-text">
                                {{internacion.evoluciones[internacion.evoluciones.length-1].texto}}
                            </p>
                            <p class="card-text">
                                <i class="fa fa-user-md"></i>
                                {{internacion.evoluciones[internacion.evoluciones.length-1].createdBy.name}}
                                {{internacion.evoluciones[internacion.evoluciones.length-1].createdAt | fromNow}}
                                <br/>
                                {{internacion.evoluciones[internacion.evoluciones.length-1].createdAt | date: "dd/MM/yyyy  'a las' HH:mm "}}
                                hs
                            </p>
                            <button type="button" class="btn btn-default col-lg-12" ng-click="tab = 3">
                                Ir a las evoluciones
                            </button>
                        </div>
                    </div>

                    <div class="card dashboard-card">
                        <div class="card-header card-purple">
                            <div class="card-header-icon">
                                <i class="mdi mdi-format-float-left"></i>
                            </div>
                            <div class="card-header-title">

                                <div class="title">Antecedentes</div>
                                <div class="subtitle"></div>
                            </div>
                        </div>
                        <div class="card-block">
                            <p class="card-text">
                                Antecedentes del paciente
                            </p>

                            <button type="button" class="btn btn-default col-lg-12" ng-click="tab = 5">
                                Ir a los antecedetnes
                            </button>
                        </div>
                    </div>

                    <div class="card dashboard-card">
                        <div class="card-header card-yellow">
                            <div class="card-header-icon">
                                <i class="mdi mdi-chart-line"></i>
                            </div>
                            <div class="card-header-title">

                                <div class="title">Indicadores</div>
                                <div class="subtitle"></div>
                            </div>
                        </div>
                        <div class="card-block">
                            <p class="card-text">

                                <div ng-if="internacion.ingreso.enfermeria.riesgoCaida.total > 0">
                                    Riesgo caidas:
                                    {{internacion.ingreso.enfermeria.riesgoCaida.total}}
                                    <span ng-if="internacion.ingreso.enfermeria.riesgoCaida.total < 25" class="small padding-left padding-right margin-left nivel-verde">Bajo</span>
                                    <span ng-if="internacion.ingreso.enfermeria.riesgoCaida.total >= 25 && internacion.ingreso.enfermeria.riesgoCaida.total <= 50" class="small padding-left padding-right margin-left nivel-amarillo">Medio</span>
                                    <span ng-if="internacion.ingreso.enfermeria.riesgoCaida.total > 50" class="small padding-left padding-right margin-left nivel-rojo">Alto</span>
                                </div>
                            </p>
                            <p class="card-text">
                                Valoración del dolor
                            </p>
                            <p class="card-text">
                                Ulceras por presión
                            </p>
                            <p class="card-text" ng-if="internacion.drenajes.length">
                                <div ng-repeat="drenaje in internacion.drenajes">
                                    <div ng-if="drenaje.fechaHasta">
                                        <i class="mdi mdi-steam" title="Drenaje {{drenaje.tipo}} {{drenaje.lado}} colocado hace {{diasColocacionDrenaje(drenaje.fechaDesde)}} días" ng-class="{'rojo': diasColocacionDrenaje(drenaje.fechaDesde) >= 5}"></i>
                                        Drenaje
                                        {{drenaje.tipo}}
                                        {{drenaje.lado}}
                                        colocado hace
                                        {{diasColocacionDrenaje(drenaje.fechaDesde)}}
                                        días
                                    </div>
                                </div>
                            </p>

                            <!-- <button type="button" class="btn btn-default col-lg-12" ng-click="tab = 4">
                                Ir a los antecedetnes
                            </button> -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="card card-block">
            <div class="row">
                <div class="col-lg-4">
                    <!-- <div plex-include="'partials/internacion/iGraficoLiquidos.html'" plex-include-internacion="internacion" ng-if="internacion.evoluciones.length > 0"></div> -->

                    <div plex-include="'partials/internacion/iGraficoTemperatura.html'" plex-include-internacion="internacion" ng-if="internacion.evoluciones.length > 0" style="width: 100%;"></div>

                </div>
                <div class="col-lg-4">

                    <div plex-include="'partials/internacion/iGraficoTension.html'" plex-include-internacion="internacion" ng-if="internacion.evoluciones.length > 0" style="width: 100%;"></div>

                </div>
                <div class="col-lg-4">

                    <div plex-include="'partials/internacion/iGraficoSaturacion.html'" plex-include-internacion="internacion" ng-if="internacion.evoluciones.length > 0" style="width: 100%;"></div>

                </div>

            </div>
        </div>

        <div class="card card-block">
            <h3 >Datos de ingreso</h3>
            <br/>
            <form>
                <div class="row">
                    <div class="col-md-2">
                        <div class="form-group">
                            <!-- <input class="form-control" type="text" label="Fecha de internación" ng-model="internacion.ingreso.fechaHora" plex="date" ng-required="true"> -->
                            <label>Fecha de internación</label>
                            <p>{{internacion.ingreso.fechaHora | date: 'dd/MM/yyyy H:mm'}}
                                hs</p>
                        </div>
                    </div>

                    <div class="col-md-2">
                        <div class="form-group">
                            <label>Tipo de ingreso</label>
                            <p>{{tipoInternacionSeleccionada.nombre}}</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label>Motivo de la internación</label>
                            <p>{{internacion.ingreso.motivo}}</p>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label>Diagnóstico presuntivo</label>
                            <p>{{internacion.ingreso.diagnosticoPresuntivo}}</p>
                        </div>
                    </div>
                </div>
            </form>
        </div>

        <div>
            <div plex-include="'partials/internacion/iEvolucionar.html'" plex-include-internacion="internacion"></div>
        </div>

        <!-- <div ng-if='Session.variables.prestaciones_workflow == "enfermero"'> -->
        <div>
            <div class="card card-block">

                <div class="row" ng-show="show_toolbar_drenajes">
                    <div class="col-md-8 col-lg-10">
                        <h3>Drenajes</h3>
                    </div>
                    <div class="col-md-4 col-lg-2 text-right" ng-if="internacion.estado != 'egresado'">
                        <br/>
                        <button class="btn btn-primary form-control" ng-click="editarDrenaje();" ng-if="!dreanajesEdit">
                            Nuevo drenaje
                        </button>
                    </div>
                </div>
                <table class="table table-hover table-striped" ng-if="internacion.drenajes.length > 0" ng-show="show_toolbar_drenajes">
                    <thead>
                        <tr>
                            <th>Lado</th>
                            <th>Tipo</th>
                            <th>Fecha colocación</th>
                            <th>Fecha extracción</th>
                            <th>Duración</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="drenaje in internacion.drenajes ">
                            <td>
                                {{drenaje.lado}}
                            </td>
                            <td>
                                {{drenaje.tipo}}
                            </td>
                            <td>
                                {{drenaje.fechaDesde | date: "dd/MM/yyyy  'a las' HH:mm "}}
                                hs
                                <!-- <br />
                                {{drenaje.fechaDesde | fromNow}} -->
                            </td>
                            <td>
                                <span ng-if="drenaje.fechaHasta">
                                    {{drenaje.fechaHasta | date: "dd/MM/yyyy  'a las' HH:mm "}}
                                    hs
                                </span>
                            </td>
                            <td>
                                <span ng-if="drenaje.fechaDesde && drenaje.fechaHasta">
                                    {{getDuration(drenaje.fechaDesde, drenaje.fechaHasta)}}
                                </span>
                            </td>
                            <td >
                                <button class="btn btn-default btn-flat tips" title="Editar drenaje" ng-click="editarDrenaje(drenaje);">
                                    <i class="mdi mdi-pencil"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <div ng-if="drenajesEdit">
                    <ng-form name="formEditarDrenaje">
                        <fieldset>
                            <legend>{{tituloFormulario}}</legend>
                            <div class="row">
                                <div class="col-md-2">
                                    <div class="form-group">
                                        <select class="form-control" label="Tipo" ng-model="drenajesEdit.tipo" plex>
                                            <option value="pleural">Pleural</option>
                                            <option value="percutaneo">Percutáneo</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="form-group">
                                        <select class="form-control" label="Lado" ng-model="drenajesEdit.lado" plex>
                                            <option value="izquierdo">Izquierdo</option>
                                            <option value="derecho">Derecho</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-2">
                                    <div class="form-group">
                                        <input class="form-control" type="text" label="Fecha desde" ng-model="drenajesEdit.fechaDesde" plex="datetime">
                                    </div>
                                </div>

                                <div class="col-xs-2" ng-if="drenajesEdit.id">
                                    <div class="form-group">
                                        <input class="form-control" type="text" label="Fecha hasta" ng-model="drenajesEdit.fechaHasta" plex="datetime">
                                    </div>
                                </div>

                            </div>
                            <div class="row">
                                <div class="col-md-12 text-right">
                                    <br/>
                                    <!-- <button type="button" class="btn btn-primary tips form-control" plex-submit="guardarDrenaje()" title="Agregar drenaje a internación">
                                        <span>
                                            <i class="mdi mdi-plus"></i> Agregar
                                        </span>
                                    </button> -->
                                    <button type="button" class="btn btn-default btn-flat" ng-click="cancelarEdicion();">Cancelar</button>
                                    <button class="btn btn-primary" plex-submit="guardarDrenaje(drenajesEdit)" ng-disabled="formEditarDrenaje.$invalid">
                                        <i class="mdi mdi-content-save"></i>
                                        Guardar</button>
                                </div>
                            </div>
                        </fieldset>
                    </ng-form>
                </div>
            </div>
        </div>

        <div class="card card-block">
            <div ng-if="internacion.ingreso.antecedentes.binarios">
                <h3>Antecedentes</h3>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>Antecedente</th>
                            <th>Observaciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="item in internacion.ingreso.antecedentes.binarios">
                            <td ng-if="item.activo">
                                <span class="text-muted">{{item.antecedente.grupo + " / "}}</span><span>{{item.antecedente.nombre}}</span>
                            </td>
                            <td ng-if="item.activo">
                                {{item.observaciones}}
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Antecedentes gineco-obstétricos -->
            <div ng-if="internacion.ingreso.antecedentes.ginecoobstetricos">
                <h5>Antecedentes gineco-obstétricos</h5>
                <div class="row">
                    <div class="col-sm-3" ng-if="internacion.ingreso.antecedentes.ginecoobstetricos.gestas">
                        Gestas: {{internacion.ingreso.antecedentes.ginecoobstetricos.gestas}}
                    </div>
                    <div class="col-sm-3" ng-if="internacion.ingreso.antecedentes.ginecoobstetricos.partos">
                        Partos: {{internacion.ingreso.antecedentes.ginecoobstetricos.partos}}
                    </div>
                    <div class="col-sm-3" ng-if="internacion.ingreso.antecedentes.ginecoobstetricos.cesareas">
                        Cesáreas: {{internacion.ingreso.antecedentes.ginecoobstetricos.cesareas}}
                    </div>
                    <div class="col-sm-3" ng-if="internacion.ingreso.antecedentes.ginecoobstetricos.abortos">
                        Abortos: {{internacion.ingreso.antecedentes.ginecoobstetricos.abortos}}
                    </div>
                </div>
            </div>

            <!-- Antecedentes varios -->
            <div ng-if="internacion.ingreso.antecedentes.quirurgicos">
                <h5>Antecedentes quirúrgicos</h5>
                {{internacion.ingreso.antecedentes.quirurgicos}}
            </div>

            <div ng-if="internacion.ingreso.antecedentes.familiares">
                <h5>Antecedentes familiares</h5>
                {{internacion.ingreso.antecedentes.familiares}}
            </div>

            <div ng-if="internacion.ingreso.antecedentes.medicacion">
                <h5>Medicación habitual</h5>
                {{internacion.ingreso.antecedentes.medicacion}}
            </div>
        </div>

        <div class="card card-block">
            <div class="row" ng-show="show_toolbar_pases">
                <div class="col-md-8 col-lg-10">
                    <h3>Pases</h3>
                </div>
                <div class="col-md-4 col-lg-2 text-right">
                    <br/>
                    <button class="btn btn-primary form-control" ng-click="editarPase();" ng-if="!pasesEdit">
                        Nuevo pase
                    </button>
                </div>
            </div>
            <div ng-if="internacion.pases && internacion.pases.length > 0">
                <table class="table table-hover table-striped">
                    <thead >
                        <tr >
                            <th >Fecha</th>
                            <th >Cama</th>
                            <th >Servicio</th>
                            <th >Resumen internación</th>
                            <th ></th>
                        </tr>
                    </thead>
                    <tbody >
                        <tr ng-repeat="item in internacion.pases | orderBy: '-fechaHora'">
                            <td >
                                {{item.fechaHora | fromNow }}<br/>
                                <div class="text-muted small">
                                    {{item.fechaHora | date: "dd/MM/yyyy HH:mm"}}
                                </div>
                            </td>
                            <td >
                                {{item.cama.habitacion}}/{{item.cama.numero}}
                            </td>
                            <td >
                                {{item.servicio.nombreCorto}}
                            </td>
                            <td >
                                {{item.resumenInternacion}}
                            </td>

                            <td >
                                <button class="btn btn-default btn-flat tips" title="Editar pase" ng-click="editarPase(item)">
                                    <i class="mdi mdi-pencil"></i>
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div ng-if="pasesEdit">
                <ng-form name="formEditarPase">
                    <fieldset>
                        <legend>{{tituloFormulario}}</legend>
                        <div class="row">
                            <div class="col-lg-2">
                                <input type=text label="Fecha" ng-model="pasesEdit.fechaHora" plex="date">
                            </div>
                            <div class="col-lg-2">
                                <input type=text label="Hora" ng-model="pasesEdit.fechaHora" plex="time">
                            </div>
                            <div class="col-lg-1">
                                <select label="Cama" ng-model="pasesEdit.cama" plex="(item.habitacion + ' / ' + item.numero) for item in camas"></select>
                            </div>
                            <div class="col-lg-2">
                                <select label="Servicio actual" ng-model="pasesEdit.servicio" min="3" plex="(item.nombre) for item in buscarUbicacion($value, 'servicio')"></select>
                            </div>
                            <div class="col-lg-2">
                                <select label="Servicio sugerido" ng-model="pasesEdit.servicioSugerido" min="3" plex="(item.nombre) for item in buscarUbicacion($value, 'servicio')"></select>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-lg-12">
                                <textarea label="Resumen de la internación" ng-model="pasesEdit.resumenInternacion" plex rows="5" class="form-control"></textarea>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 text-right">
                                <br/>
                                <button type="button" class="btn btn-default btn-flat" ng-click="cancelarEdicionPase();">Cancelar</button>
                                <button class="btn btn-primary" plex-submit="guardarPase(pasesEdit)" ng-disabled="formEditarPase.$invalid">
                                    <i class="mdi mdi-content-save"></i>
                                    Guardar</button>
                            </div>
                        </div>
                    </fieldset>
                </ng-form>
            </div>

        </div>

        <div class="card card-block">
        </div>

        <div class="card card-block">
            <div ng-if="internacion.egreso">
                <h3 >Egreso</h3>
                <div ng-if="internacion.egreso">
                    <table class="table table-hover table-striped">
                        <thead >
                            <tr >
                                <th >Fecha</th>
                                <th >Cama</th>
                                <th >Servicio</th>
                                <th >Tipo</th>
                                <th >Resumen</th>
                            </tr>
                        </thead>
                        <tbody >
                            <tr >
                                <td >
                                    {{internacion.egreso.fechaHora | fromNow }}<br/>
                                    <div class="text-muted small">
                                        {{internacion.egreso.fechaHora | date: "dd/MM/yyyy HH:mm"}}
                                    </div>
                                </td>
                                <td >
                                    {{internacion.egreso.cama.habitacion}}/{{internacion.egreso.cama.numero}}
                                </td>
                                <td >
                                    {{item.servicio.nombreCorto}}
                                </td>
                                <td >
                                    {{internacion.egreso.tipo}}
                                </td>
                                <td ></td>

                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="card card-block container-timeline">

            <div class="row">
                <div class="col-md-offset-2 col-md-9">
                    <div class="timeline-centered timeline-sm">
                        <article class="timeline-entry" ng-repeat="elemento in ordenCronologico" ng-class="{'left-aligned': $even}">
                            <div class="timeline-entry-inner">
                                <time datetime="{{elemento.fecha}}" class="timeline-time">
                                    <span>{{elemento.fecha | date: "HH:mm"}}
                                        hs</span>
                                    <span>{{elemento.fecha | date: "dd 'de' MMMM 'de' yyyy"}}</span>
                                </time>

                                <div class="timeline-icon bg-ingreso" ng-if="elemento.tipo == 'Ingreso'">
                                    <i class="fa fa-bed"></i>
                                </div>

                                <div class="timeline-icon bg-valoracion-inicial" ng-if="elemento.tipo == 'Valoración inicial'">
                                    <i class="mdi mdi-receipt"></i>
                                </div>

                                <div class="timeline-icon bg-pase" ng-if="elemento.tipo == 'Pase'">
                                    <i class="mdi mdi-walk"></i>
                                </div>

                                <div class="timeline-icon bg-pase" ng-if="elemento.tipo == 'Colocación de drenaje' || elemento.tipo == 'Extracción de drenaje'">
                                    <i class="mdi mdi-steam"></i>
                                </div>

                                <div class="timeline-icon bg-evolucion" ng-if="elemento.tipo == 'Evolución'">
                                    <i class="mdi mdi-clipboard-outline"></i>
                                </div>

                                <div class="timeline-icon bg-egreso" ng-if="elemento.tipo == 'Egreso'">
                                    <i class="mdi mdi-exit-to-app"></i>
                                </div>

                                <div class="timeline-label">
                                    <h4 class="timeline-title {{elemento._tipo}}">
                                        {{elemento.tipo}}
                                        <div class="numero-habitacion pull-right">
                                            {{elemento.cama.habitacion}}
                                            /
                                            {{elemento.cama.numero}}
                                        </div>
                                    </h4>

                                    <div ng-if="elemento.tipo == 'Ingreso'">
                                        <p>
                                            Tipo de ingreso:
                                            {{elemento.data.tipo}}

                                            <span ng-if="elemento.data.dipo == 'derivacion'">Derivado desde:
                                                {{elemento.data.derivadoDesde.nombreCorto}}
                                            </span>
                                            <br/>
                                            Motivo:
                                            {{elemento.data.motivo}}
                                            <br/>
                                            Diagnóstico presuntivo:
                                            {{elemento.data.diagnosticoPresuntivo}}
                                        </p>
                                    </div>

                                    <div ng-if="elemento.tipo == 'Valoración inicial'">
                                        <p>
                                            <i class="fa fa-user-md"></i>
                                            {{internacion.createdBy.name}}
                                        </p>
                                    </div>

                                    <div ng-if="elemento.tipo == 'Evolución'">
                                        <p>
                                            Servicio:
                                            {{elemento.data.servicio.nombreCorto}}
                                            <br/>
                                            <i class="fa fa-user-md"></i>
                                            {{elemento.data.createdBy.name}}
                                        </p>
                                    </div>

                                    <div ng-if="elemento.tipo == 'Pase'">
                                        <p>
                                            Pase hacia
                                            {{elemento.data.servicio.nombreCorto}}
                                            <br/>
                                            Cama:
                                            {{elemento.data.cama.habitacion}}
                                            /
                                            {{elemento.data.cama.numero}}
                                        </p>
                                    </div>

                                    <div ng-if="elemento.tipo == 'Colocación de drenaje'">
                                        <p>
                                            Colocación de drenaje
                                            {{elemento.data.tipo}}
                                            en el lado
                                            {{elemento.data.lado}}

                                        </p>
                                    </div>

                                    <div ng-if="elemento.tipo == 'Extracción de drenaje'">
                                        <p>
                                            Extracción de drenaje
                                            {{elemento.data.tipo}}
                                            colocado en el lado
                                            {{elemento.data.lado}}
                                            Tiempo colocado:
                                            {{elemento.duracion}}
                                        </p>
                                    </div>

                                    <div ng-if="elemento.tipo == 'Egreso'">
                                        <p>
                                            Tiempo internado:
                                            {{elemento.duracion}}
                                            <br/>

                                            Cama:
                                            {{elemento.data.cama.habitacion}}
                                            /
                                            {{elemento.data.cama.numero}}
                                            <br/>

                                            Servicio:
                                            {{elemento.data.servicio.nombreCorto}}
                                        </p>
                                        <p>
                                            Tipo de alta:
                                            {{elemento.data.tipoAlta}}
                                            <br/>
                                            <span ng-if="elemento.data.diagnosticoAlta">Diagnóstico de alta:
                                                {{elemento.data.diagnosticoAlta}}</span>
                                            <span ng-if="elemento.data.derivadoHacia">Derivado hacia:
                                                {{elemento.data.derivadoHacia.nombreCorto}}
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </article>
                        </div>
                    </div>
                </div>
            </div>

        </div>

    </div>
